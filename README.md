# acnh_flowers
养花资料
TLDR 结论
## 原理
动森的花杂交是以孟德尔的杂交模型为基础的，每种花有若干等位基因，不同基因型会表现出不同的花色。
|花|等位基因数量| 基因型数量| 表现型数量|
|---|---|---|---|
|玫瑰|4|81|8(+1)|
|波斯菊|3|27|6|
|风信子|3|27|7|
|百合|3|27|6|
|菊花|3|27|6|
|三色堇|3|27|6|
|郁金香|3|27|7|
|银莲花|3|27|6|

基因层面，根据孟德尔的模型，我们是能知道很多的，比如两个基因型交配，能得到什么基因，各有多少概率。这个我算好了，打表在[csv/table3.csv](csv/table3.csv)，[csv/table4.csv](csv/table4.csv)

但是花色层面，我们没有先验知识。只能借助于破解资料。
[google doc](https://docs.google.com/spreadsheets/d/11pRCX8G0xGizSYWgVhoUSu7pE-MV7AOprBcgSY1whB4)
从资料我们知道什么基因会有什么花色,资料已经下载放在csv目录下。

根据上面的信息，已经足够对杂交起到足够的指导作用了，我们能够知道什么花色交配能出什么花色。但是关键的是概率，我们等不了无限的时间来等蓝玫瑰开花，尽管从上面的资料我们知道完全杂合体的粉色玫瑰(`01,01,01,01`)可以开出任何花色。


## 概率的疑问
> “概率我们早已经知道了。”

曾经我也这么认为，给出两个基因型，用高中知识就能求出任何子代的基因型的概率，网上的资料也是这么算的。这个repo的之前版本也是计算的基因概率来搜索种花方法的。

仔细的推敲一下基因算概率的问题。
- 波斯菊的红种子`11,00,00`和黄种子`00,11,01`，他们的后代会是
  基因|概率
  -|-
  `01,01,00`|50%
  `01,01,01`|50%

  于是得出了50%是一种花色，50%是另一种花色的结论吗？

  不！这两种基因型的花色都是橙色，红种子+黄种子 100% 出橙色。

- 你从红种子和黄种子种出了2朵橙色，然而你不知道这个橙色究竟是`01,01,00`还是`01,01,01`。假设都是`01,01,00`，那么可以出表
  基因|概率|花色
  -|-|-
  `00,00,00`|6.25%|白
  `01,00,00`|12.5%|粉
  `11,00,00`|6.25%|红
  `00,01,00`|12.5%|黄
  `01,01,00`|25%|橙
  `11,01,00`|12.5%|橙
  `00,11,00`|6.25%|黄
  `01,11,00`|12.5%|红
  `11,11,00`|6.25%|黑

  一朵是`01,01,00`一朵是`01,01,01`和两朵都是`01,01,01`都能照此计算。

  但是回到的假设，你并不知道两朵花到底是这3种情况中的哪一种，于是概率的用处就开始模糊了。
这里的重点是，有2层数据，一层是基因，一层是花色。我们只能通过花色来选花，而基因层对我们来说是不可知的，至少是难知道的。当然知道基因型，上面的计算没什么问题。甚至通过长期实验，可以做假设检验来确定一朵花的基因型。但这不切实际。
回到之前repo版本的问题。你算了，但是发现结果很散，很难整理，而且结果不是常见的数据结构，子代的数量越算越多，而且会返祖回到父代，计算量和逻辑组织的双重压力。

于是我换到模拟的思路。

## 这个repo计算的概率
由上面知道，从基因计算的概率，虽然准确，但是并不符合实际。我们需要在基因不完全确定的情况下，依据花色来计算实际可用的概率，不过着手点还是基因。

分析一下，实际游戏中的能确定基因型的操作有
1. 种花种子，基本有3色，基因是确定的。
2. 杂交花，知道是从哪两朵花交来的，能知道基因的范围
3. 自我复制，能有未知但确定的基因
4. ~~野岛的花，基因也是固定的~~ 新版本已经没有异花岛了

岛花的基因其实不确定，因为一下雨就都乱了，不好做稳定出花的原材料。  
~~而野岛的花，并不方便入手，所以暂时放弃不纳入考虑。~~  
而自我复制，虽然是确定的基因，但不会有新花色出现，所以必须和杂交一起操作，先复制自己，然后自己和自己杂交，才是一个有用的操作，这里把这两个合并起来的操作叫做**自交**。

计算各个操作的概率，主要是计算各种条件概率：
1. 种子，完全确定的基因和花色，概率是显然的。
2. 自交，先是从来源确定各个基因的概率，然后各个基因的概率再乘上基因自己和自己杂交的出基因的条件概率。
3. 杂交，先得到两方自身的基因的概率，然后乘上确定基因时子代基因的条件概率。

模拟一下，会发现种花过程其实还有一个显然的步骤，看花色。我们不会盲目地把杂交出的子代不管花色直接进行下一代杂交，而是会把需要的花色移到另一个地方去继续杂交。这个步骤也是一个杂交之后计算概率的重要步骤，上面的概率主要还是在计算基因的概率，而此处是对基因依据表现型花色的分组，所以是一个基因概率求和得到花色概率的过程。

### 关于自交
为什么要自交，而不是单纯地把同色花种在一起？  
实际种植的时候会产生这种情况，同色的花其实有n种基因，此时如果混在一起杂交，会产生n*n种杂交的情况，概率会稀释掉。
而如果选的都是种出花色之后自我复制一次的自交，那么相当于取的是对角线元素，只有n种情况，概率会高很多。
但是反过来说，如果一花色只有1种基因，那么自交和杂交就区别不大，反而自交还要等复制，拖节奏。

另外，概率计算的是出花之前不确定基因的情况，如果花种出来了，基因确定了，条件概率的一部分就确定了，概率会有变化。由此，对于自交的花如果出了目标花色，那可以留住继续出。反之，如果老是没有出目标花色，就建议铲掉放弃这朵花，这花可能是分母而不是分子。

下面是模拟结果

## 花色指南
### 波斯菊

异色花有3种，橙，粉，黑。

```
橙 = 种子红+种子黄 100%
```
```
粉 = 种子红+种子白 100%
```
黑色比较难出，最高也就14%。提供2种养法
- 欧洲人种法
   ```
  1. 种子红+种子黄 100% 出橙1(2种基因)
  2. 橙1自交 5.47% 出黑
   ```
- 稳妥种法
  ```
  1. 种子红+种子黄 100% 出橙1(2种基因)
  2. 橙1 + 种子红 50% 出橙2(4种基因)
  3. 橙2自交(最低4.6%，最高25%) 14.65% 出黑
  ```

### 风信子

异色有4种，橙，粉，蓝，紫
```
橙 = 种子红+种子黄 50%
```
```
粉 = 种子红+种子白 50%
```
```
蓝 = 种子白+种子白 25%
```
- 欧洲人出紫法
  ```
  1. 种子红+种子黄 50% 出橙1
  2. 橙1自交 6.25%出紫
  ```
- 稳妥打法
  ```
  1.红黄 50% 橙1(唯一基因)
  2.橙色1+红 12.5% 蓝2(唯一基因)
  3. 蓝2 自交 25% 紫
  ```

### 百合
异色有3种，黑，粉，橙
```
黑 = 种子红+种子红 25%
```
```
橙 = 种子红+种子黄 50%
```
```
粉 = 种子红+种子白 50%
```
### 菊花
异色花有3种，紫，粉，绿
```
紫 = 种子白+种子白 25%
```
```
粉 = 种子红 +种子白 100%
```
- 欧洲绿法
  ```
  1. 种子红+ 种子黄 100% 出黄1(唯一基因)
  2. 黄1自交或者黄1+黄1杂交 6.25%出绿
  ```
- 稳妥绿
  ```
  1. 种子红+种子黄 100% 出黄1(唯一基因)
  2. 黄1+种子黄 或者 黄1+种子红 25% 出紫2(唯一基因)
  3. 紫2 自交 25% 出绿
  ```
### 三色堇
异色花有3种，橙，蓝，紫
```
橙 = 种子红+种子黄 100%
```
```
蓝= 种子白+种子白 25%
```

紫比较难，
- 欧洲出法
  ```
  1.种子红+种子白 100% 红1
  2. 红1 自交 3.12%出紫
  ```
- 稍微好一点的做法
  ```
  1. 种子红+ 种子白 100%  红1(2种基因)
  2. 种子白+ 种子白 25% 蓝1(唯一基因)
  3. 红1+蓝1 25% 蓝2(2种基因)
  4. 蓝2 自交 12.5% 紫
  ```

### 郁金香
异色4种，橙，粉，紫，黑
```
橙 = 种子红+种子黄 50%
```
```
粉 = 种子红+种子白 50%
```
```
黑 = 种子红+种子红 25%
```
- 欧洲紫
  ```
  1. 种子红+ 种子黄 出 橙1(唯一基因) 50% 黄1(唯一基因) 50%
  2. 橙1 自交 或者 黄1 自交 6.25% 出紫
  ```
- 普通紫
  ```
  1. 种子红+ 种子黄 50% 橙1(唯一基因)
  2. 黄1+种子黄 25% 橙2(2种基因)
  3. 橙1 自交 (最低6.25%，最高25%)15.62% 出紫
  ```
### 银莲花
异色3种，蓝，紫，粉
```
粉 = 种子红 + 种子橙 100%
```
```
蓝= 种子白 + 种子白 25%
```
- 欧洲紫
  ```
  1. 种子红 + 种子白  100% 出 红1(2种基因)
  2. 红1 自交 3.12% 出紫
  ```
- 普通紫
  ```
  1. 种子红+种子白 100% 红1(2种基因)
  2. 种子白 + 种子白 25% 出 蓝1(唯一基因)
  3. 红1 + 蓝1 25% 出 蓝2(2种基因)
  4. 蓝2 自交(最低0%，最高25%) 12.5% 出 紫
  ```
### 玫瑰
异色5种，橙，紫，粉，黑，蓝
```
紫 = 种子白 + 种子白 25%
```
```
橙 = 种子红 + 种子黄 50%
```
```
粉 = 种子红 + 种子白 50%
```
```
黑 = 种子红 + 种子红 25%
```
蓝玫瑰是本游戏最难出的花了，多提供几种方法
- 欧洲蓝1
  ```
  1. 种子红 + 种子白  50% 出 红1
  2. 红1 + 种子黄 12.5% 出红2
  3. 红2 自交 1.56% 出蓝
  ```
- 欧洲蓝2
  ```
  1. 种子红+ 种子黄 50% 橙1
  2. 种子黄+种子白 50% 白1
  3. 黄1 +白1 25% 橙2(3种基因)
  4. 橙2 自交(2种0，一个6.25%) 1.56% 蓝
  ```
- 蓝3
  ```
  1. 种子红+种子黄 50% 出 橙1(唯一基因)
  2. 种子黄+种子白 50% 出 白1(唯一基因)
  3. 橙1 + 白1 25% 出 橙2(3种基因,12.5%, 6.25%, 6.25%)
  4. 橙2 自交(大量0%，最高12.5%) 9.375% 出 红3(2种基因)(12.5%, 0,12.5%)
  5. 红3 自交 8.333%(一个0%，一个25%)  出现 蓝玫瑰
  ```
在第5步骤，只有1个基因是需要的，另1个基因是废的。反推回去，其实在4这一步，2种橙色也是废的，只有1种橙色自交才能出5需要的红，并且这种橙，本身就能小概率产生蓝（蓝2配方）
最后归结到在3的橙2里找需要的橙色，剩下的就都顺利了。
### 考虑测交
考虑这三种橙能出的颜色，和出这种颜色的概率，选定了种子白x种子白得到的紫玫瑰作为测交亲本。
白白出紫的概率是25%，这个紫色是唯一基因。  
紫色和两种废物橙2杂交，不能出紫色。但是和有用的橙2杂交，有25%出紫色。
列个表

| 杂交后代|白|红|紫|
|---|---|---|---|
|废物橙2a| 50%|50%| 0%|
|废物橙2b| 50%|50%| 0%|
|有用橙2c| 25%|50%| 25%|


用192黑（种子红杂交）有20%让废物橙出黑，其他不行，用这个可以筛掉大量
如果只剩下废物2b和有用2c，那么也可可以用这个黑来筛选出对的有用橙
192是纯合子，自己和自己交只能出现192（自己）
| 杂交后代|红|黑|橙|
|---|---|---|---|
|废物橙2a| 25%|25%| 50%|
|废物橙2b| 0%|0%| 100%
|有用橙2c| 50%|0%| 50%|

杂交出来的红3区分

k可以看出出黑这对红就废掉了

| 杂交后代|红|白|黑|蓝|
|---|---|---|---|
|废红3a| 50%|25%| 25%| 0%|
|目标红3b| 50%|25%| 0| 25%|

更高的筛选效率有50%，没有更高了。计算下来最容易的到手的测交是种子黄
| 杂交后代|黄|橙|
|---|---|---|
|废红3a| 100%|0%|
|目标红3b| 50%|50%|
